# ๐ค Async Telegram Analytics Bot - Telegram-ะฑะพั ะดะปั ะฐะฝะฐะปะธัะธะบะธ ะฒะธะดะตะพ

> **ะะฝัะตะปะปะตะบััะฐะปัะฝัะน ะฑะพั ะดะปั ะฐะฝะฐะปะธะทะฐ ะฒะธะดะตะพ-ััะฐัะธััะธะบะธ ัะตัะตะท ะตััะตััะฒะตะฝะฝัะน ัะทัะบ**

Telegram-ะฑะพั, ะบะพัะพััะน ะธัะฟะพะปัะทัะตั GPT-4o-mini ะดะปั ะฟัะตะพะฑัะฐะทะพะฒะฐะฝะธั ะฒะพะฟัะพัะพะฒ ะฝะฐ ััััะบะพะผ ัะทัะบะต ะฒ SQL-ะทะฐะฟัะพัั ะธ ะฟัะตะดะพััะฐะฒะปัะตั ะฐะฝะฐะปะธัะธะบั ะฟะพ ะฒะธะดะตะพ-ะบะพะฝัะตะฝัั.

---

## ๐ ะะณะปะฐะฒะปะตะฝะธะต

- [ะะพะทะผะพะถะฝะพััะธ](#-ะฒะพะทะผะพะถะฝะพััะธ)
- [ะขะตัะฝะพะปะพะณะธะธ](#-ัะตัะฝะพะปะพะณะธะธ)
- [ะัััััะน ััะฐัั](#-ะฑัััััะน-ััะฐัั)
- [ะัะฟะพะปัะทะพะฒะฐะฝะธะต](#-ะธัะฟะพะปัะทะพะฒะฐะฝะธะต)
- [ะััะธัะตะบัััะฐ](#-ะฐััะธัะตะบัััะฐ)
- [ะะพะบัะผะตะฝัะฐัะธั](#-ะดะพะบัะผะตะฝัะฐัะธั)

---

## โจ ะะพะทะผะพะถะฝะพััะธ

- ๐ฃ๏ธ **ะััะตััะฒะตะฝะฝัะน ัะทัะบ** - ะทะฐะดะฐะฒะฐะนัะต ะฒะพะฟัะพัั ะฝะฐ ััััะบะพะผ
- ๐ค **Text-to-SQL ัะตัะตะท LLM** - ะฐะฒัะพะผะฐัะธัะตัะบะฐั ะณะตะฝะตัะฐัะธั SQL ะธะท ัะตะบััะฐ
- โก **ะะพะปะฝะพัััั ะฐัะธะฝััะพะฝะฝัะน** - ะฒััะพะบะฐั ะฟัะพะธะทะฒะพะดะธัะตะปัะฝะพััั
- ๐ข **ะขะพัะฝัะต ะพัะฒะตัั** - ัะพะปัะบะพ ัะธัะปะฐ, ะฝะธะบะฐะบะธั ะณะฐะปะปััะธะฝะฐัะธะน

---

## ๏ฟฝ๏ธ ะขะตัะฝะพะปะพะณะธะธ

| ะะพะผะฟะพะฝะตะฝั | ะขะตัะฝะพะปะพะณะธั | ะะตััะธั |
|-----------|-----------|---------|
| ะฏะทัะบ | Python | 3.11+ |
| ะะพั | aiogram | 3.x |
| ะะ | PostgreSQL | 15+ |
| ORM | SQLAlchemy + asyncpg | 2.x |
| LLM | OpenAI GPT-4o-mini | API |

---

## ๐ ะัััััะน ััะฐัั

### ะะฐัะธะฐะฝั 1: ะะพะบะฐะปัะฝัะน ะทะฐะฟััะบ

#### 1๏ธโฃ ะะปะพะฝะธัะพะฒะฐะฝะธะต ะธ ัััะฐะฝะพะฒะบะฐ

```bash
git clone https://github.com/wh1tespirit/Async-Telegram-Analytics-Bot.git
cd Async-Telegram-Analytics-Bot
pip install -r requirements.txt
```

#### 2๏ธโฃ ะะฐัััะพะนะบะฐ ะพะบััะถะตะฝะธั

ะกะพะทะดะฐะนัะต `.env` ัะฐะนะป:

```env
# Telegram Bot
BOT_TOKEN=1234567890:ABCdefGHIjklMNOpqrsTUVwxyz

# OpenAI API
OPENAI_API_KEY=sk-proj-xxxxxxxxxxxxx

# Database
DB_USER=postgres
DB_PASS=postgres
DB_HOST=localhost
DB_PORT=5432
DB_NAME=testbot
```

#### 3๏ธโฃ ะะฐะฟััะบ PostgreSQL

```bash
psql -U postgres -c "CREATE DATABASE testbot;"
```

#### 4๏ธโฃ ะะฐะณััะทะบะฐ ะดะฐะฝะฝัั

```bash
python -m app.database.loader
```

#### 5๏ธโฃ ะะฐะฟััะบ ะฑะพัะฐ

```bash
python bot.py
```
---

## ๏ฟฝ ะัะฟะพะปัะทะพะฒะฐะฝะธะต

### ะะพะผะฐะฝะดั ะฑะพัะฐ

- `/start` - ะฟัะธะฒะตัััะฒะธะต ะธ ะฟัะธะผะตัั
- `/help` - ัะฟัะฐะฒะบะฐ ะฟะพ ะธัะฟะพะปัะทะพะฒะฐะฝะธั

### ะัะธะผะตัั ะทะฐะฟัะพัะพะฒ

```
ะะพะปัะทะพะฒะฐัะตะปั: ะกะบะพะปัะบะพ ะฒัะตะณะพ ะฒะธะดะตะพ?
ะะพั: 358

ะะพะปัะทะพะฒะฐัะตะปั: ะกะบะพะปัะบะพ ะฒะธะดะตะพ ะฝะฐะฑัะฐะปะพ ะฑะพะปััะต 100000 ะฟัะพัะผะพััะพะฒ?
ะะพั: 16

ะะพะปัะทะพะฒะฐัะตะปั: ะะฐ ัะบะพะปัะบะพ ะฒััะพัะปะธ ะฟัะพัะผะพััั 28 ะฝะพัะฑัั 2025?
ะะพั: 18777

ะะพะปัะทะพะฒะฐัะตะปั: ะกะบะพะปัะบะพ ัะฐะทะฝัั ะฒะธะดะตะพ ะฟะพะปััะฐะปะธ ะฟัะพัะผะพััั 27 ะฝะพัะฑัั?
ะะพั: 243
```

### ะขะธะฟั ะฒะพะฟัะพัะพะฒ

| ะขะธะฟ | ะัะธะผะตั |
|-----|--------|
| ะะพะดััะตั | "ะกะบะพะปัะบะพ ะฒัะตะณะพ ะฒะธะดะตะพ?" |
| ะคะธะปัััะฐัะธั | "ะกะบะพะปัะบะพ ะฒะธะดะตะพ ะฝะฐะฑัะฐะปะพ ะฑะพะปััะต 1 ะผะปะฝ ะฟัะพัะผะพััะพะฒ?" |
| ะัะตะผะตะฝะฝัะต ะดะธะฐะฟะฐะทะพะฝั | "ะกะบะพะปัะบะพ ะฒะธะดะตะพ ะฒััะปะพ ั 1 ะฟะพ 5 ะฝะพัะฑัั?" |
| ะะธะฝะฐะผะธะบะฐ | "ะะฐ ัะบะพะปัะบะพ ะฒััะพัะปะธ ะปะฐะนะบะธ ะทะฐ 28 ะฝะพัะฑัั?" |
| ะฃะฝะธะบะฐะปัะฝะพััั | "ะกะบะพะปัะบะพ ัะฐะทะฝัั ะฒะธะดะตะพ ะฟะพะปััะฐะปะธ ะฟัะพัะผะพััั?" |

---

## ๐๏ธ ะััะธัะตะบัััะฐ

### ะะฑัะฐั ััะตะผะฐ

```
โโโโโโโโโโโโโโโโโโโ
โ   ะะพะปัะทะพะฒะฐัะตะปั  โ
โโโโโโโโโโฌโโโโโโโโโ
         โ ะะพะฟัะพั ะฝะฐ ััััะบะพะผ
         โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ      Telegram Bot (aiogram)     โ
โโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโ
         โ
         โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ      Query Service              โ
โ   (ะบะพะพัะดะธะฝะฐัะธั ะบะพะผะฟะพะฝะตะฝัะพะฒ)     โ
โโโโโโโฌโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโ
      โ                  โ
      โ                  โ
โโโโโโโโโโโโโโโโ   โโโโโโโโโโโโโโโ
โ LLM Service  โ   โSQL Executor โ
โ GPT-4o-mini  โ   โ PostgreSQL  โ
โโโโโโโโฌโโโโโโโโ   โโโโโโโโฌโโโโโโโ
       โ                  โ
       โ SQL Query        โ Result
       โโโโโโโโโโโโฌโโโโโโโโ
                  โ
         โโโโโโโโโโโโโโโโโโ
         โ  ะัะฒะตั (ัะธัะปะพ)  โ
         โโโโโโโโโโโโโโโโโโ
```

### ะกัััะบัััะฐ ะฟัะพะตะบัะฐ

```
TestBot/
โโโ bot.py                      # ๐ ะขะพัะบะฐ ะฒัะพะดะฐ
โโโ app/
โ   โโโ database/
โ   โ   โโโ models.py           # ๐ SQLAlchemy ะผะพะดะตะปะธ
โ   โ   โโโ db.py               # ๐ ะะพะดะบะปััะตะฝะธะต ะบ ะะ
โ   โ   โโโ loader.py           # ๐ฅ ETL ะดะปั ะทะฐะณััะทะบะธ ะดะฐะฝะฝัั
โ   โ   โโโ data/videos.json    # ๐ ะััะพะดะฝัะต ะดะฐะฝะฝัะต
โ   โโโ services/
โ   โ   โโโ llm_service.py      # ๐ง Text-to-SQL ัะตัะตะท GPT
โ   โ   โโโ sql_executor.py     # ๐พ ะัะฟะพะปะฝะตะฝะธะต SQL
โ   โ   โโโ query_service.py    # ๐ฏ ะะปะฐะฒะฝัะน ัะตัะฒะธั
โ   โโโ storage/
โ       โโโ config.py           # โ๏ธ ะะพะฝัะธะณััะฐัะธั
โโโ requirements.txt            # ๐ฆ ะะฐะฒะธัะธะผะพััะธ
โโโ .env                        # ๐ ะะตัะตะผะตะฝะฝัะต ะพะบััะถะตะฝะธั
```

### ะะฐะทะฐ ะดะฐะฝะฝัั

**ะขะฐะฑะปะธัะฐ `videos`** - ะธัะพะณะพะฒะฐั ััะฐัะธััะธะบะฐ:
```sql
id, creator_id, video_created_at, 
views_count, likes_count, comments_count, reports_count
```

**ะขะฐะฑะปะธัะฐ `video_snapshots`** - ะฟะพัะฐัะพะฒัะต ะทะฐะผะตัั:
```sql
id, video_id, created_at,
views_count, delta_views_count,
likes_count, delta_likes_count, ...
```

๐ **ะะพะดัะพะฑะฝะตะต:** [DATABASE_SCHEMA.md](DATABASE_SCHEMA.md)

### LLM ะัะพะผะฟั (Text-to-SQL)

ะกะธััะตะผะฝัะน ะฟัะพะผะฟั ัะพะดะตัะถะธั:

1. **ะะพะปะฝะพะต ะพะฟะธัะฐะฝะธะต ััะตะผั ะะ** (DDL-style)
2. **6 ะฟัะธะผะตัะพะฒ ะทะฐะฟัะพัะพะฒ** (few-shot learning)
3. **ะัะฐะฒะธะปะฐ ะณะตะฝะตัะฐัะธะธ SQL**:
   - ะขะพะปัะบะพ SELECT, COUNT, SUM
   - ะัะธะฒะตะดะตะฝะธะต ะดะฐั ัะตัะตะท `::date`
   - ะัะฟะพะปัะทะพะฒะฐะฝะธะต COALESCE ะดะปั NULL
4. **ะะพะฝัะตะบััะฝะฐั ะธะฝัะพัะผะฐัะธั** (ัะตะบััะฐั ะดะฐัะฐ, ะณะพะด ะฟะพ ัะผะพะปัะฐะฝะธั)

๐ **ะะพะดัะพะฑะฝะตะต:** [LLM_SERVICE.md](LLM_SERVICE.md)

---

## ๐งช ะขะตััะธัะพะฒะฐะฝะธะต

### ะขะตัั ะฑะฐะทั ะดะฐะฝะฝัั

```bash
python -m app.database.test_db
```

### ะขะตัั LLM-ัะตัะฒะธัะฐ

```bash
python test_llm.py                # ะะฒัะพะผะฐัะธัะตัะบะธะต ัะตััั
python test_llm.py --interactive  # ะะฝัะตัะฐะบัะธะฒะฝัะน ัะตะถะธะผ
```

---

## ๐ ะะพะบัะผะตะฝัะฐัะธั

- [DATABASE_SCHEMA.md](DATABASE_SCHEMA.md) - ััะตะผะฐ ะะ ะธ ะฟัะธะผะตัั SQL
- [LLM_SERVICE.md](LLM_SERVICE.md) - ะฐััะธัะตะบัััะฐ Text-to-SQL

---

## ๏ฟฝ ะะปััะตะฒัะต ะพัะพะฑะตะฝะฝะพััะธ

### โก ะะพะปะฝะฐั ะฐัะธะฝััะพะฝะฝะพััั

```python
# ะัะต ะฝะฐ async/await
await bot.send_message(...)      # aiogram
await session.execute(query)     # asyncpg
await client.chat.completions()  # AsyncOpenAI
```

### ๐ฏ ะะฐะดะตะถะฝะพััั

- **ะะฑัะฐะฑะพัะบะฐ ะพัะธะฑะพะบ** ะฝะฐ ะฒัะตั ััะพะฒะฝัั
- **ะะฐะปะธะดะฐัะธั SQL** ะฟะตัะตะด ะฒัะฟะพะปะฝะตะฝะธะตะผ
- **ะะพะณะธัะพะฒะฐะฝะธะต** ะฒัะตั ะพะฟะตัะฐัะธะน
- **Graceful shutdown** ะฟัะธ ะพััะฐะฝะพะฒะบะต

### ๐ ะัะพะธะทะฒะพะดะธัะตะปัะฝะพััั

- **Bulk insert** ะฟัะธ ะทะฐะณััะทะบะต ะดะฐะฝะฝัั (5000+ ะทะฐะฟะธัะตะน/ัะตะบ)
- **ะะฝะดะตะบัั** ะฝะฐ ัะฐััะพ ะธัะฟะพะปัะทัะตะผัั ะฟะพะปัั
- **Connection pooling** ะดะปั ะะ

---

## ๏ฟฝ ะะธัะตะฝะทะธั

MIT License - ัะฒะพะฑะพะดะฝะพะต ะธัะฟะพะปัะทะพะฒะฐะฝะธะต

---

## ๐จโ๏ฟฝ ะะฒัะพั

ะะฐะทัะฐะฑะพัะฐะฝะพ ะบะฐะบ ัะตััะพะฒะพะต ะทะฐะดะฐะฝะธะต ะดะปั ะฟะพะทะธัะธะธ **Python Developer**

---

## ๐ค ะะพะดะดะตัะถะบะฐ

ะะพะทะฝะธะบะปะธ ะฒะพะฟัะพัั? ะัะบัะพะนัะต Issue ะฒ ัะตะฟะพะทะธัะพัะธะธ ะธะปะธ ัะฒัะถะธัะตัั ั ะฐะฒัะพัะพะผ.

**ะัะธััะฝะพะณะพ ะธัะฟะพะปัะทะพะฒะฐะฝะธั! ๐**
